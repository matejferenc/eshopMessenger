<!DOCTYPE html>
<html>
<head>
    <title>Facebook Checkbox Plugin Demo</title>
</head>

<body>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '826661794148248',
      xfbml      : true,
      version    : 'v2.9'
    });

    FB.Event.subscribe('messenger_checkbox', function(e) {
      console.log("messenger_checkbox event");
      console.log(e);

      if (e.event == 'rendered') {
        console.log("Plugin was rendered");
      } else if (e.event == 'checkbox') {
        var checkboxState = e.state;
        console.log("Checkbox state: " + checkboxState);
      } else if (e.event == 'not_you') {
        console.log("User clicked 'not you'");
      } else if (e.event == 'hidden') {
        console.log("Plugin was hidden");
      }

    });

  };

  (function(d, s, id){
    var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk')
  );

  function confirmOrder() {
    FB.AppEvents.logEvent('MessengerCheckboxUserConfirmation', null, {
      'app_id': '826661794148248',
      'page_id': '1889282338015127',
      'ref': 'PASS_THROUGH_PARAM 1',
      'user_ref': '<%= userRef %>'
    });
  };

  function processOrder(userRef, orderId) {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() {
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
            messengerReceivedOrderConfirmation(xmlHttp.responseText);
    }
    xmlHttp.open("GET", "https://goodreservation.com:6443/confirm?userRef=" + userRef + "&orderId=" + orderId, true); // true for asynchronous
    xmlHttp.send(null);
  };

  function messengerReceivedOrderConfirmation(responseText) {
    console.log("Messenger received order confirmation: " + responseText);
  }


</script>

<h1>Facebook Messenger Checkbox Plugin Demo</h1>

<div class="fb-messenger-checkbox"
     origin="https://goodreservation.com:6443"
     page_id="1889282338015127"
     messenger_app_id="826661794148248"
     user_ref="<%= userRef %>"
     prechecked="true"
     allow_login="true"
     size="large"></div>

<input type="button" onclick="confirmOrder()" value="User Confirms Order"/>

<input type="text" id="orderId">

<input type="button" onclick="processOrder('<%= userRef %>', '<%= orderId %>')" value="E-shop Processes Order"/>


</body>

</html>